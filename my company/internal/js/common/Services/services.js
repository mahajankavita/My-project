var app=angular.module('App');app.service('CommonService',function($location,$filter,$http,globals){'use strict';var CommonService={};CommonService.formatReg=function(registrationNo){var regNo=registrationNo;regNo=regNo.replace(/-/g,"");var regNoArray=new Array(4);regNoArray[0]=regNo.slice(0,2);regNoArray[1]='';regNoArray[2]='';regNoArray[3]='';try{if(!isNaN(regNo.slice(2,4))){regNoArray[1]=regNo.slice(2,4);}
else{if(!isNaN(regNo.slice(2,3))){regNoArray[1]=regNo.slice(2,3);}
if(isNaN(regNo.slice(3,4))){regNoArray[2]=regNo.slice(3,4);}}
if(!isNaN(regNo.slice(4,8))){regNoArray[3]=regNoArray[3]+regNo.slice(4,8);}
else{regNoArray[2]=regNoArray[2]+regNo.slice(4,5);if(isNaN(regNo.slice(5,6))==true&&isNaN(regNo.slice(6,7))==true){regNoArray[2]=regNoArray[2]+regNo.slice(5,7);}
else{if(isNaN(regNo.slice(5,6))){regNoArray[2]=regNoArray[2]+regNo.slice(5,6);}
else{regNoArray[3]=regNoArray[3]+regNo.slice(5,6);}
if(!isNaN(regNo.slice(6,7))){regNoArray[3]=regNoArray[3]+regNo.slice(6,7);}}
if(!isNaN(regNo.slice(7,11))){regNoArray[3]=regNoArray[3]+regNo.slice(7,11);}}}
catch(e){}
return regNoArray.join('-').replace(/--/g,"-").replace(/-\s*$/,"").replace(/[^- 0-9 a-z A-z]/g,"");};CommonService.insurancecompanies=function(data){var request=$http({method:"POST",url:globals.IGwServiceURL+"/IGGeneralServices.svc/web/GetInsurer",headers:{'Content-Type':'application/json; charset=utf-8'},dataType:"json",data:JSON.stringify({"RequestString":data})});return request;};CommonService.SendOTPReboot=function($scope){var mbl=$scope.userMobile;var vData={"IsResend":$scope.resendFlag,"MobileNumber":mbl,"CP_ID":$scope.IGQuoteId,"ClientKey":$scope.encryptedData($scope.IGQuoteId.toString()+mbl)}
var request=$http({method:"POST",dataType:"json",url:globals.ServiceURL+"/Lead.svc/web/SendOTPReboot",contentType:"application/json; charset=utf-8",data:JSON.stringify(vData)});return request;};CommonService.citylist=function($scope){var vData={IsTopLocation:$scope.CityValue};var request=$http({method:"POST",dataType:"json",url:globals.ServiceURL+'/MasterService.svc/web/GetCityList',contentType:"application/json; charset=utf-8",data:JSON.stringify(vData)});return request;};CommonService.getCountrylist=function(){var request=$http({method:"POST",url:globals.ServiceURL+'/MasterService.svc/web/GetCountryList',});return request;};CommonService.carmakemodel=function(carname,rtocode){var requestdata={"data":{"CarIDs":4,"CarMakeModelVarientFuleTypeCombination":carname,'rto':rtocode}};var request=$http({method:"POST",dataType:"json",url:globals.IGwServiceURL+"/InsureJoyServices.svc/web/CarMakeModelVarientFuelTypeService",contentType:"application/json; charset=utf-8",data:JSON.stringify(requestdata)});return request;};CommonService.setsessionvariable=function(key,data){var vData={type:"Set",key:0,sessionValue:JSON.stringify(data,null,"")};var request=$http({method:"POST",dataType:'jsonp',url:globals.IGwServiceURL+"/InsureJoyServices.svc/web/SetSession",data:JSON.stringify(vData)});return request;};CommonService.bikemakemodelservice=function(data){var request=$http({method:"post",url:globals.ServiceURL+"/MasterService.svc/web/GetTWModelList",contentType:"application/json; charset=utf-8",dataType:"json",data:JSON.stringify({"Combination":""})});return request;};CommonService.bikertoservice=function(data,rtocode){var request=$http({method:"POST",url:globals.ServiceURL+"/MasterService.svc/web/GetTWRTOList",contentType:"application/json; charset=utf-8",dataType:"json",data:JSON.stringify({"Combination":data,"FLADRtoata":rtocode})});return request;};CommonService.carupdatedmakemodelservice=function(data){var request=$http({method:"POST",url:globals.ServiceURL+"/MasterService.svc/web/GetCarModelList",contentType:"application/json; charset=utf-8",dataType:"json",data:JSON.stringify({"Combination":""})});return request;};CommonService.carupdatedrtoservice=function(data){var request=$http({method:"POST",url:globals.ServiceURL+"/MasterService.svc/web/GetCarRTOList",contentType:"application/json; charset=utf-8",dataType:"json",data:JSON.stringify({"Combination":""})});return request;};CommonService.fastlane=function(data){var requestdata={inputString:data};var request=$http({method:"POST",url:globals.IGwServiceURL+"/VehicleLookupService.svc/web/GetVehicleLookup",contentType:"application/json",dataType:"json",data:requestdata});return request;};CommonService.getCPIDdata=function(data){var requestdata=parseInt(data);var request=$http({method:"POST",url:globals.ServiceURL+"/Lead.svc/web/GetContinueJourneyDetails",contentType:"application/json",dataType:"json",data:requestdata});return request;};CommonService.sethelpdeskticket=function(data){var request=$http({method:"POST",url:globals.fershDeskURL,headers:{"Authorization":"Basic "+btoa("67PZTI5zoRxGMNT3H4HW"+":x")},contentType:"application/json",dataType:"json",data:data});return request;};CommonService.saveCarRequirementData=function($scope,globals){if($scope.carbreaking==0&&$scope.carbreakingexp==1)
{var breaking=91;}
else if($scope.carbreaking==0&&$scope.carbreakingexp==0)
{var breaking=90;}
else{var breaking=0;}
var requestdata={"IGQuoteId":0,"IsDnc":true,"PartnerAgentId":$scope.utmpartneragentiddata,"PartnerLeadId":$scope.utmpartnerleadiddata,"RequestType":"","IPAddress":"1.1.1.1","LandingURL":globals.RedirectURL,"Requests":[{"__type":"CarRequest:#ServiceEntities","ProductId":4,"BreakingDays":breaking,"ClaimTaken":$scope.ClaimTaken,"ClaimedNCB":$scope.carclaimedncb,"RequiredNCB":$scope.carrequiredncb,"IDV":0,"InsurerIds":[1,17],"IsNewVehicle":false,"ModelId":$scope.selectedItem.ModelId,"RTOCode":$scope.selectedItem1.RTOCode,"KitValue":$scope.$root.entercngkitvalue,"RegistrationYear":$scope.carreg,"RegistrationNo":$scope.carregnumber,"ChasisNo":$scope.bikechasisno==undefined?"":$scope.bikechasisno,"EngineNo":$scope.formengineno==undefined?"":$scope.formengineno,"Features":[{"__type":"BooleanFeature:#ServiceEntities","Name":"ZeroDept","IsSelected":false},{"__type":"BooleanFeature:#ServiceEntities","Name":"RSAC","IsSelected":false},{"__type":"BooleanFeature:#ServiceEntities","Name":"NCBProtection","IsSelected":false},{"__type":"BooleanFeature:#ServiceEntities","Name":"Invoice","IsSelected":false},{"__type":"BooleanFeature:#ServiceEntities","Name":"Enginegear","IsSelected":false},{"__type":"BooleanFeature:#ServiceEntities","Name":"KeyLockReplacement","IsSelected":false},{"__type":"BooleanFeature:#ServiceEntities","Name":"HydrostaticLock","IsSelected":false},{"__type":"BooleanFeature:#ServiceEntities","Name":"Hospital","IsSelected":false},{"__type":"BooleanFeature:#ServiceEntities","Name":"Medical","IsSelected":false},{"__type":"BooleanFeature:#ServiceEntities","Name":"CashAllowance","IsSelected":false},{"__type":"BooleanFeature:#ServiceEntities","Name":"TyreCover","IsSelected":false},{"__type":"BooleanFeature:#ServiceEntities","Name":"CostOfConsumables","IsSelected":false},{"__type":"BooleanFeature:#ServiceEntities","Name":"AntiTheftDevice","IsSelected":false},{"__type":"BooleanFeature:#ServiceEntities","Name":"LegalLiabilityPaidDriver","IsSelected":false},{"__type":"CustomFeature:#ServiceEntities","Name":"PAUnnamed","Value":0,"IsSelected":false},{"__type":"CustomFeature:#ServiceEntities","Name":"VoluntryDiscount","Value":0,"IsSelected":false},{"__type":"CustomFeature:#ServiceEntities","Name":"ElectricalAccessory","Value":0,"IsSelected":false},{"__type":"CustomFeature:#ServiceEntities","Name":"NonElectricalAccessory","Value":0,"IsSelected":false},{"__type":"CNGFeature:#ServiceEntities","Name":"CNG","Type":"NONE","Value":$scope.$root.entercngkitvalue},{"__type":"AAIFeature:#ServiceEntities","Name":"AAI","LicenseNumber":"6324523vsadfa","AssociateName":"mangal deep gupta","ExpiryDate":JSON.parse(CommonService.stringifyWcf("12-12-2017",1)),"IsLifeMember":true,"IsSelected":false}]}],"ServiceTimeOut":11,"utmMedium":$scope.utmmediumdata,"utmCompaign":$scope.utmcampaigndata,"utmSource":$scope.utmsourcedata,"utmTerm":$scope.utmtermdata};var request=$http({method:"POST",dataType:"jsonp",url:globals.ServiceURL+"/QuoteService.svc/web/Save",data:requestdata});return request;};CommonService.saveBikeRequirementData=function($scope){var requestdata={"IGQuoteId":0,"IsDnc":true,"IsOffline":true,"PartnerAgentId":$scope.utmpartneragentiddata,"PartnerLeadId":$scope.utmpartnerleadiddata,"RequestType":"","IPAddress":"1.1.1.1","LandingURL":globals.RedirectURL,"Requests":[{"__type":"TWRequest:#ServiceEntities","ProductId":8,"BreakingDays":$scope.bikeexpiredpol,"ClaimTaken":$scope.ClaimTaken,"ClaimedNCB":$scope.ClaimedNCB,"RequiredNCB":$scope.RequiredNCB,"IDV":0,"InsurerIds":[1,17],"IsNewVehicle":false,"ModelId":$scope.selectedbikemmv.modelid,"RTOCode":$scope.selectedbikerto.RTOCode,"RegistrationYear":$scope.bikereg,"RegistrationNo":$scope.bikeregnumber,"ChasisNo":$scope.bikechasisno==undefined?"":$scope.bikechasisno,"EngineNo":$scope.bikeengineno==undefined?"":$scope.bikeengineno,"Features":[{"__type":"BooleanFeature:#ServiceEntities","Name":"ZeroDept","IsSelected":false},{"__type":"BooleanFeature:#ServiceEntities","Name":"RSAC","IsSelected":false},{"__type":"CustomFeature:#ServiceEntities","Name":"PAUnnamed","Value":0}]}],"ServiceTimeOut":11,"utmMedium":$scope.utmmediumdata,"utmCompaign":$scope.utmcampaigndata,"utmSource":$scope.utmsourcedata,"utmTerm":$scope.utmtermdata};var request=$http({method:"POST",dataType:"jsonp",url:globals.ServiceURL+"/QuoteService.svc/web/Save",data:requestdata});return request;};CommonService.saveHealthRequirementData=function($scope,globals){var requestdata={"IGQuoteId":0,"IsDnc":true,"PartnerAgentId":$scope.utmpartneragentiddata,"PartnerLeadId":$scope.utmpartnerleadiddata,"RequestType":"","IPAddress":"1.1.1.1","LandingURL":globals.RedirectURL,"Requests":[{"__type":"HealthRequest:#ServiceEntities","Features":[],"ProductId":2,"IsOffline":true,"CityId":parseInt(($scope.selectedItem2.cityid.split(',')[0]).trim()),"DOB":JSON.parse(CommonService.stringifyWcf($scope.formdob,1)),"Gender":$scope.gender,"InsurerIds":"","IsQuotes":"","NetworkHospital1":null,"NetworkHospital2":null,"NetworkHospital3":null,"NumberOfAdults":parseInt($scope.selectedadult),"NumberOfChildren":parseInt($scope.selectedchild),"PolicyTerm":1,"SumInsured":550000,"Medicaltest":0,"DiseasID":"","FeatureID":"","HospitalID":"","IGQuoteId":0}],"ServiceTimeOut":123,"utmMedium":$scope.utmmediumdata,"utmCompaign":$scope.utmcampaigndata,"utmSource":$scope.utmsourcedata,"utmTerm":$scope.utmtermdata};var request=$http({method:"POST",dataType:"jsonp",url:globals.ServiceURL+"/QuoteService.svc/web/Save",data:requestdata});return request;};CommonService.saveTermRequirementData=function($scope,globals){var requestdata={"IGQuoteId":0,"IsDnc":true,"PartnerAgentId":$scope.utmpartneragentiddata,"PartnerLeadId":$scope.utmpartnerleadiddata,"RequestType":"","IPAddress":"1.1.1.1","LandingURL":globals.RedirectURL,"Requests":[{"__type":"TermRequest:#ServiceEntities","Features":null,"ProductId":3,"AnnualIncomeRange":$scope.txtActualIncome.ActualIncomeValue,"CityID":parseInt(($scope.selectedItem2.cityid.split(',')[0]).trim()),"DateOfBirth":JSON.parse(CommonService.stringifyWcf($scope.formdob,1)),"Gender":$scope.gender,"IsTobacco":$scope.formtobacco.toLowerCase(),"PayingMode":'Yearly',"PolicyTerm":0,"SelectedRiders":[],"SumAssured":$scope.SumAssured,"UserInputIncome":parseInt($scope.txtActualIncome.ActualIncomeValue),"MinAnnualIncomeRange":parseInt($scope.minincome),"MaxAnnualIncomeRange":parseInt($scope.maxincome),"Features":null}],"ServiceTimeOut":0,"utmMedium":$scope.utmmediumdata,"utmCompaign":$scope.utmcampaigndata,"utmSource":$scope.utmsourcedata,"utmTerm":$scope.utmtermdata};var request=$http({method:"POST",dataType:"jsonp",url:globals.ServiceURL+"/QuoteService.svc/web/Save",data:requestdata});return request;};CommonService.saveTermRequirementDatanew=function($scope,globals){var requestdata={"IGQuoteId":0,"IsDnc":true,"PartnerAgentId":$scope.utmpartneragentiddata,"PartnerLeadId":$scope.utmpartnerleadiddata,"RequestType":"","IPAddress":"1.1.1.1","LandingURL":globals.RedirectURL,"Requests":[{"__type":"TermRequest:#ServiceEntities","Features":null,"ProductId":3,"AnnualIncomeRange":$scope.anula_inc,"CityID":0,"DateOfBirth":JSON.parse(CommonService.stringifyWcf($scope.formdob,1)),"Gender":$scope.gender,"IsTobacco":$scope.formtobacco,"PayingMode":'Yearly',"PolicyTerm":0,"SelectedRiders":[],"SumAssured":$scope.SumAssured,"UserInputIncome":parseInt($scope.anula_inc),"MinAnnualIncomeRange":parseInt($scope.minincome),"MaxAnnualIncomeRange":parseInt($scope.maxincome),"Features":null}],"ServiceTimeOut":0,"utmMedium":$scope.utmmediumdata,"utmCompaign":$scope.utmcampaigndata,"utmSource":$scope.utmsourcedata,"utmTerm":$scope.utmtermdata};var request=$http({method:"POST",dataType:"jsonp",url:globals.ServiceURL+"/QuoteService.svc/web/Save",data:requestdata});return request;};CommonService.saveInvestmentRequirementData=function($scope,globals){var requestdata={"IGQuoteId":0,"IsDnc":true,"PartnerAgentId":$scope.utmpartneragentiddata,"PartnerLeadId":$scope.utmpartnerleadiddata,"RequestType":"","Requests":[{"__type":"NonTermRequest:#ServiceEntities","DOBs":[JSON.parse(CommonService.stringifyWcf($scope.formdob,1))],"Features":[{"__type":"BooleanFeature:#ServiceEntities","Id":"0","Name":""},{"__type":"CustomFeature:#ServiceEntities","Name":"","Id":"0"},{"__type":"CustomFeature:#ServiceEntities","Id":"0","Name":""},{"__type":"CustomFeature:#ServiceEntities","Id":"0","Name":""},{"__type":"CustomFeature:#ServiceEntities","Id":"0","Name":""},],"Amount":$scope.txtActualIncome,"PayingMode":$scope.selectedincome,"MaturityTerm":"5","MaxMaturityTerm":40,"Gender":$scope.formgender,"CityId":3035,"MinRisk":0,"MaxRisk":0,"ProductId":5,"MaturityType":"HistoricalGrowth","PaymentDuration":40}],"ServiceTimeOut":"2147483647","utmMedium":$scope.utmmediumdata,"utmCompaign":$scope.utmcampaigndata,"utmSource":$scope.utmsourcedata,"utmTerm":$scope.utmtermdata};var request=$http({method:"POST",dataType:"jsonp",url:globals.ServiceURL+"/QuoteService.svc/web/Save",data:requestdata});return request;};CommonService.savePensionRequirementData=function($scope,globals){var requestdata={"IGQuoteId":0,"IsDnc":true,"PartnerAgentId":$scope.utmpartneragentiddata,"PartnerLeadId":$scope.utmpartnerleadiddata,"RequestType":"String content","Requests":[{"__type":"NonTermRequest:#ServiceEntities","DOBs":[JSON.parse(CommonService.stringifyWcf($scope.formdob,1))],"Features":[{"__type":"BooleanFeature:#ServiceEntities","Name":"","Id":0}],"Amount":$scope.txtActualIncome,"PayingMode":$scope.payMode,"MaturityTerm":"24","Gender":$scope.formgender,"CityId":3035,"PensionFor":"self","ProductId":6,"MinRisk":0,"MaxRisk":0,"PaymentDuration":24,"PensionTill":90}],"ServiceTimeOut":2147483647,"utmMedium":$scope.utmmediumdata,"utmCompaign":$scope.utmcampaigndata,"utmSource":$scope.utmsourcedata,"utmTerm":$scope.utmtermdata};var request=$http({method:"POST",dataType:"jsonp",url:globals.ServiceURL+"/QuoteService.svc/web/Save",data:requestdata});return request;};CommonService.saveChildRequirementData=function($scope,globals){var requestdata={"IGQuoteId":0,"IsDnc":true,"PartnerAgentId":$scope.utmpartneragentiddata,"PartnerLeadId":$scope.utmpartnerleadiddata,"RequestType":"","Requests":[{"__type":"NonTermRequest:#ServiceEntities","DOBs":[JSON.parse(CommonService.stringifyWcf($scope.formdob,1)),JSON.parse(CommonService.stringifyWcf($scope.childDOB,1))],"Features":[{"__type":"BooleanFeature:#ServiceEntities","Id":"0","Name":""},{"__type":"BooleanFeature:#ServiceEntities","Id":"0","Name":""}],"Amount":$scope.selectedincome,"MaturityTerm":$scope.MaturityTerm,"Gender":$scope.formgender,"CityId":3035,"MinRisk":1,"MaxRisk":5,"ProductId":7,"MaturityType":"HistoricalGrowth","PaymentDuration":0}],"ServiceTimeOut":"2147483647","utmMedium":$scope.utmmediumdata,"utmCompaign":$scope.utmcampaigndata,"utmSource":$scope.utmsourcedata,"utmTerm":$scope.utmtermdata};var request=$http({method:"POST",dataType:"jsonp",url:globals.ServiceURL+"/QuoteService.svc/web/Save",data:requestdata});return request;};CommonService.saveTravelRequirementData=function($scope,globals){if($scope.formtraveldestinations)
var requestdata={"IGQuoteId":0,"IsDnc":true,"PartnerAgentId":$scope.utmpartneragentiddata,"PartnerLeadId":$scope.utmpartnerleadiddata,"RequestType":"","Requests":[{"__type":"TravelRequest:#ServiceEntities","Features":[],"ProductId":1,"CityId":3035,"DOBs":$scope.DOBArray,"Destinations":$scope.formtraveldestinations.toString().split(","),"EndDate":JSON.parse(CommonService.stringifyWcf($scope.formtravelenddate,3)),"PolicyType":1,"StartDate":JSON.parse(CommonService.stringifyWcf($scope.formtravelstartdate,3)),"SumInsured":50000,"TripType":1}],"utmMedium":$scope.utmmediumdata,"utmCompaign":$scope.utmcampaigndata,"utmSource":$scope.utmsourcedata,"utmTerm":$scope.utmtermdata};var request=$http({method:"POST",dataType:"jsonp",url:globals.ServiceURL+"/QuoteService.svc/web/Save",data:requestdata});return request;};CommonService.GetMobileVerificationWithOTPRequest=function(data){var requestdata={RequestString:JSON.stringify(data.RequestString,null,"    ")};var request=$http({method:"POST",dataType:"jsonp",url:globals.IGwServiceURL+"/Leadcreate.svc/web/GetMobileVerificationWithOTPRequest",data:JSON.stringify(requestdata)});return request;};CommonService.GetMobileVerificationWithOTPRequest1=function(data){var requestdata={RequestString:JSON.stringify(data.RequestString,null,"    ")};var request=$http({method:"POST",dataType:"jsonp",url:globals.IGwServiceURL+"/Lead.svc/web/GetLeadCreateRequest",data:JSON.stringify(requestdata)});return request;};CommonService.GetMobileVerificationWithOTPRequest2=function(data){var requestdata={RequestString:JSON.stringify(data.RequestString,null,"    ")};var request=$http({method:"POST",dataType:"jsonp",url:globals.IGwServiceURL+"/Lead.svc/web/GetOTPVerificationRequest",data:JSON.stringify(requestdata)});return request;}
CommonService.stringifyWcf=function(json,flag){var reISO=/^(\d{4})-(\d{2})-(\d{2})T(\d{2}):(\d{2}):(\d{2}(?:\.\d*)?)Z$/;var reMsAjax=/^\/Date\((d|-|.*)\)[\/|\\]$/;return JSON.stringify(json,function(key,value1){var value;if(typeof value1=="string"){if(flag==1)
{value=value1.split('-')[1]+'-'+value1.split('-')[0]+'-'+value1.split('-')[2];}
else if(flag==3)
{value=value1.split('/')[0]+'-'+value1.split('/')[1]+'-'+value1.split('/')[2];}
else
{value=value1.split('-')[1]+'-'+value1.split('-')[0]+'-'+value1.split('-')[2];}
value1=new Date(value);if(isNaN(Date.parse(value1))){var splitdata=value.split('-');value=new Date(splitdata[2],splitdata[0]-1,(splitdata[1]));}
else{value=new Date(value)}
value=value.setDate(value.getDate()+1);var s=JSON.parse(JSON.stringify(new Date(value)));var a=reISO.exec(s);if(a){var val='/Date('+new Date(Date.UTC(+a[1],+a[2]-1,+a[3],+a[4],+a[5],+a[6])).getTime()+')/';this[key]=val;return val;}}
return value;})}
return CommonService;});